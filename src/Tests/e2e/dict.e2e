// Tests for Dict (HAMT) implementation

// Empty dict
Stdlib.Dict.empty() = 0

// Get from empty dict returns -1 (not found)
Stdlib.Dict.get(Stdlib.Dict.empty(), 42) = -1

// Set and get single value
Stdlib.Dict.get(Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100), 1) = 100

// Get non-existent key from non-empty dict
Stdlib.Dict.get(Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100), 2) = -1

// Set multiple values
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in Stdlib.Dict.get(d2, 1) = 100

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in Stdlib.Dict.get(d2, 2) = 200

// Update existing key
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 1, 999) in Stdlib.Dict.get(d2, 1) = 999

// Three values
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.set(d2, 3, 30) in Stdlib.Dict.get(d3, 1) = 10

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.set(d2, 3, 30) in Stdlib.Dict.get(d3, 2) = 20

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.set(d2, 3, 30) in Stdlib.Dict.get(d3, 3) = 30

// Keys with same hash chunk at level 0 (testing internal node expansion)
// Keys 0 and 64 have the same 6-bit chunk at level 0 (both are 0 & 63 = 0)
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 0, 1000) in let d2 = Stdlib.Dict.set(d1, 64, 2000) in Stdlib.Dict.get(d2, 0) = 1000

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 0, 1000) in let d2 = Stdlib.Dict.set(d1, 64, 2000) in Stdlib.Dict.get(d2, 64) = 2000

// ========== Dict.remove tests ==========

// Remove from single-entry dict
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.remove(d1, 1) in Stdlib.Dict.get(d2, 1) = -1

// Remove non-existent key (dict unchanged)
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.remove(d1, 999) in Stdlib.Dict.get(d2, 1) = 100

// Remove one key, other keys remain
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in let d3 = Stdlib.Dict.set(d2, 3, 300) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 1) = 100

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in let d3 = Stdlib.Dict.set(d2, 3, 300) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 2) = -1

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in let d3 = Stdlib.Dict.set(d2, 3, 300) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 3) = 300

// Immutability: original dict unchanged after remove
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.remove(d1, 1) in Stdlib.Dict.get(d1, 1) = 100

// Remove all keys one by one
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.remove(d2, 1) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 1) = -1

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.remove(d2, 1) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 2) = -1

// Remove from empty dict (no-op)
Stdlib.Dict.get(Stdlib.Dict.remove(Stdlib.Dict.empty(), 1), 1) = -1

// ========== String-keyed Dict tests ==========

// Get from empty dict with string key
Stdlib.Dict.get_str(Stdlib.Dict.empty(), "hello") = -1

// Set and get single string key
Stdlib.Dict.get_str(Stdlib.Dict.set_str(Stdlib.Dict.empty(), "hello", 100), "hello") = 100

// Get non-existent string key from non-empty dict
Stdlib.Dict.get_str(Stdlib.Dict.set_str(Stdlib.Dict.empty(), "hello", 100), "world") = -1

// Set multiple string keys
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "one", 1) in let d2 = Stdlib.Dict.set_str(d1, "two", 2) in Stdlib.Dict.get_str(d2, "one") = 1

let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "one", 1) in let d2 = Stdlib.Dict.set_str(d1, "two", 2) in Stdlib.Dict.get_str(d2, "two") = 2

// Update existing string key
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "key", 100) in let d2 = Stdlib.Dict.set_str(d1, "key", 999) in Stdlib.Dict.get_str(d2, "key") = 999

// Three string keys
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "a", 10) in let d2 = Stdlib.Dict.set_str(d1, "b", 20) in let d3 = Stdlib.Dict.set_str(d2, "c", 30) in Stdlib.Dict.get_str(d3, "a") = 10

let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "a", 10) in let d2 = Stdlib.Dict.set_str(d1, "b", 20) in let d3 = Stdlib.Dict.set_str(d2, "c", 30) in Stdlib.Dict.get_str(d3, "b") = 20

let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "a", 10) in let d2 = Stdlib.Dict.set_str(d1, "b", 20) in let d3 = Stdlib.Dict.set_str(d2, "c", 30) in Stdlib.Dict.get_str(d3, "c") = 30

// ========== String Dict remove tests ==========

// Remove from single-entry dict
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "key", 100) in let d2 = Stdlib.Dict.remove_str(d1, "key") in Stdlib.Dict.get_str(d2, "key") = -1

// Remove non-existent key (dict unchanged)
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "key", 100) in let d2 = Stdlib.Dict.remove_str(d1, "other") in Stdlib.Dict.get_str(d2, "key") = 100

// Remove one key, other keys remain
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "a", 100) in let d2 = Stdlib.Dict.set_str(d1, "b", 200) in let d3 = Stdlib.Dict.set_str(d2, "c", 300) in let d4 = Stdlib.Dict.remove_str(d3, "b") in Stdlib.Dict.get_str(d4, "a") = 100

let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "a", 100) in let d2 = Stdlib.Dict.set_str(d1, "b", 200) in let d3 = Stdlib.Dict.set_str(d2, "c", 300) in let d4 = Stdlib.Dict.remove_str(d3, "b") in Stdlib.Dict.get_str(d4, "b") = -1

let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "a", 100) in let d2 = Stdlib.Dict.set_str(d1, "b", 200) in let d3 = Stdlib.Dict.set_str(d2, "c", 300) in let d4 = Stdlib.Dict.remove_str(d3, "b") in Stdlib.Dict.get_str(d4, "c") = 300

// Immutability: original dict unchanged after remove
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "key", 100) in let d2 = Stdlib.Dict.remove_str(d1, "key") in Stdlib.Dict.get_str(d1, "key") = 100

// Empty string as key
Stdlib.Dict.get_str(Stdlib.Dict.set_str(Stdlib.Dict.empty(), "", 42), "") = 42

// Edge case: keys that differ only in length
let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "ab", 1) in let d2 = Stdlib.Dict.set_str(d1, "abc", 2) in Stdlib.Dict.get_str(d2, "ab") = 1

let d1 = Stdlib.Dict.set_str(Stdlib.Dict.empty(), "ab", 1) in let d2 = Stdlib.Dict.set_str(d1, "abc", 2) in Stdlib.Dict.get_str(d2, "abc") = 2
