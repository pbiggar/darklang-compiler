// Tests for Dict (HAMT) implementation

// Empty dict
Stdlib.Dict.empty() = 0

// Get from empty dict returns -1 (not found)
Stdlib.Dict.get(Stdlib.Dict.empty(), 42) = -1

// Set and get single value
Stdlib.Dict.get(Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100), 1) = 100

// Get non-existent key from non-empty dict
Stdlib.Dict.get(Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100), 2) = -1

// Set multiple values
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in Stdlib.Dict.get(d2, 1) = 100

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in Stdlib.Dict.get(d2, 2) = 200

// Update existing key
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 1, 999) in Stdlib.Dict.get(d2, 1) = 999

// Three values
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.set(d2, 3, 30) in Stdlib.Dict.get(d3, 1) = 10

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.set(d2, 3, 30) in Stdlib.Dict.get(d3, 2) = 20

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.set(d2, 3, 30) in Stdlib.Dict.get(d3, 3) = 30

// Keys with same hash chunk at level 0 (testing internal node expansion)
// Keys 0 and 64 have the same 6-bit chunk at level 0 (both are 0 & 63 = 0)
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 0, 1000) in let d2 = Stdlib.Dict.set(d1, 64, 2000) in Stdlib.Dict.get(d2, 0) = 1000

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 0, 1000) in let d2 = Stdlib.Dict.set(d1, 64, 2000) in Stdlib.Dict.get(d2, 64) = 2000

// ========== Dict.remove tests ==========

// Remove from single-entry dict
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.remove(d1, 1) in Stdlib.Dict.get(d2, 1) = -1

// Remove non-existent key (dict unchanged)
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.remove(d1, 999) in Stdlib.Dict.get(d2, 1) = 100

// Remove one key, other keys remain
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in let d3 = Stdlib.Dict.set(d2, 3, 300) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 1) = 100

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in let d3 = Stdlib.Dict.set(d2, 3, 300) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 2) = -1

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.set(d1, 2, 200) in let d3 = Stdlib.Dict.set(d2, 3, 300) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 3) = 300

// Immutability: original dict unchanged after remove
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 100) in let d2 = Stdlib.Dict.remove(d1, 1) in Stdlib.Dict.get(d1, 1) = 100

// Remove all keys one by one
let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.remove(d2, 1) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 1) = -1

let d1 = Stdlib.Dict.set(Stdlib.Dict.empty(), 1, 10) in let d2 = Stdlib.Dict.set(d1, 2, 20) in let d3 = Stdlib.Dict.remove(d2, 1) in let d4 = Stdlib.Dict.remove(d3, 2) in Stdlib.Dict.get(d4, 2) = -1

// Remove from empty dict (no-op)
Stdlib.Dict.get(Stdlib.Dict.remove(Stdlib.Dict.empty(), 1), 1) = -1
