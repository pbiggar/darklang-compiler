// Stdlib.Dict Tests
// Tests for Dict module functions
//
// NOTE: Dict tests use String keys for simplicity since that's the most common use case.

// ===================================================================
// Dict.empty - Create empty dictionary
// ===================================================================

Dict.isEmpty<String, Int64>(Dict.empty<String, Int64>()) = stdout="true\n"
Dict.size<String, Int64>(Dict.empty<String, Int64>()) = stdout="0\n"

// ===================================================================
// Dict.singleton - Create single-entry dictionary
// ===================================================================

Dict.size(Dict.singleton("key", 42)) = stdout="1\n"
Dict.isEmpty(Dict.singleton("key", 42)) = stdout="false\n"
Option.withDefault(Dict.get(Dict.singleton("key", 42), "key"), 0) = 42

// ===================================================================
// Dict.set - Add/update entries
// ===================================================================

Option.withDefault(Dict.get(Dict.set(Dict.empty<String, Int64>(), "a", 1), "a"), 0) = 1
Dict.size(Dict.set(Dict.set(Dict.empty<String, Int64>(), "a", 1), "b", 2)) = stdout="2\n"

// ===================================================================
// Dict.get - Lookup values
// ===================================================================

Option.isNone<Int64>(Dict.get<String, Int64>(Dict.empty<String, Int64>(), "missing")) = stdout="true\n"
Option.withDefault(Dict.get(Dict.singleton("hello", 100), "hello"), 0) = 100
Option.isNone<Int64>(Dict.get(Dict.singleton("hello", 100), "world")) = stdout="true\n"

// ===================================================================
// Dict.contains - Check if key exists
// ===================================================================

Dict.contains(Dict.singleton("key", 42), "key") = stdout="true\n"
Dict.contains(Dict.singleton("key", 42), "other") = stdout="false\n"
Dict.contains<String, Int64>(Dict.empty<String, Int64>(), "any") = stdout="false\n"

// ===================================================================
// Dict.remove - Remove entries
// ===================================================================

Dict.isEmpty(Dict.remove(Dict.singleton("key", 42), "key")) = stdout="true\n"
Dict.contains(Dict.remove(Dict.singleton("key", 42), "key"), "key") = stdout="false\n"
Dict.size(Dict.remove(Dict.set(Dict.set(Dict.empty<String, Int64>(), "a", 1), "b", 2), "a")) = stdout="1\n"

// ===================================================================
// Dict.getOrDefault - Get with fallback
// ===================================================================

Dict.getOrDefault(Dict.singleton("key", 42), "key", 0) = 42
Dict.getOrDefault<String, Int64>(Dict.empty<String, Int64>(), "missing", 99) = 99
Dict.getOrDefault(Dict.singleton("hello", 100), "world", 50) = 50

// ===================================================================
// Dict.toList - Convert to list of pairs (alias for entries)
// ===================================================================

List.length(Dict.toList<String, Int64>(Dict.empty<String, Int64>())) = stdout="0\n"
List.length(Dict.toList(Dict.singleton("key", 42))) = stdout="1\n"
List.length(Dict.toList(Dict.set(Dict.set(Dict.empty<String, Int64>(), "a", 1), "b", 2))) = stdout="2\n"

// ===================================================================
// Dict.keys - Get all keys
// ===================================================================

List.length(Dict.keys<String, Int64>(Dict.empty<String, Int64>())) = stdout="0\n"
List.length(Dict.keys(Dict.singleton("key", 42))) = stdout="1\n"

// ===================================================================
// Dict.values - Get all values
// ===================================================================

List.length(Dict.values<String, Int64>(Dict.empty<String, Int64>())) = stdout="0\n"
List.length(Dict.values(Dict.singleton("key", 42))) = stdout="1\n"

// ===================================================================
// Dict.fromList - Build from list of pairs
// ===================================================================

Dict.size(Dict.fromList<String, Int64>([])) = stdout="0\n"
// TODO: Uncomment when tuple-in-list crash is fixed
// Dict.size(Dict.fromList([("a", 1), ("b", 2), ("c", 3)])) = stdout="3\n"
// Option.withDefault(Dict.get(Dict.fromList([("x", 100)]), "x"), 0) = 100

// ===================================================================
// Dict.merge - Combine dictionaries
// ===================================================================

Dict.size(Dict.merge(Dict.singleton("a", 1), Dict.singleton("b", 2))) = stdout="2\n"
// Second dict wins on conflicts
Option.withDefault(Dict.get(Dict.merge(Dict.singleton("key", 1), Dict.singleton("key", 2)), "key"), 0) = 2
