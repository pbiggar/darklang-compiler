// Optimizer Constant Folding Tests
//
// These tests verify that the optimizer correctly folds constants.
// This exercises:
// - Unary operation folding (negation, not)
// - Constant propagation through variables
// - Combined optimizations

// ===================================================================
// Unary Operation Folding
// ===================================================================
// Test that negation and not are folded correctly

// Negation through variables (can't be folded at parse time)
let x = 5 in -x = -5
let x = -10 in -x = 10
let x = 0 in -x = 0

// Negation of expressions
let x = 3 in let y = 2 in -(x + y) = -5
let x = 10 in let y = 3 in -(x - y) = -7

// Boolean not through variables
let b = true in !b = stdout="false\n"
let b = false in !b = stdout="true\n"

// Nested not
let b = true in !!b = stdout="true\n"
let b = false in !!b = stdout="false\n"

// ===================================================================
// Constant Propagation
// ===================================================================
// Verify constants propagate through multiple let bindings

// Simple propagation
let x = 10 in x = 10
let x = 10 in let y = x in y = 10
let x = 10 in let y = x in let z = y in z = 10

// Propagation with arithmetic
let x = 5 in let y = x + 3 in y = 8
let x = 10 in let y = x * 2 in let z = y + 1 in z = 21

// ===================================================================
// Combined Optimizations
// ===================================================================
// Test that multiple optimizations work together

// Const fold + DCE
let unused = 1 + 2 in let x = 5 in x + 1 = 6

// Const prop + const fold
let a = 3 in let b = 4 in a * b = 12
let a = 10 in let b = a + 5 in let c = b * 2 in c = 30

// Negation + const prop + const fold
let x = 5 in let y = -x in let z = y + 10 in z = 5
